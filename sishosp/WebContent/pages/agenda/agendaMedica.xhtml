<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:b="http://bootsfaces.net/ui">

<ui:composition template="../../template/template.xhtml">

	<ui:define name="body">

		<h3>Agenda Médica</h3>
		<h:form id="formAgendaMedica">
			<p:growl id="msgFeriado" />
			<div class="form-group">
				<h:outputLabel value="Paciente" styleClass="col-sm-1 control-label" />
				<div class="col-sm-4">
					<p:outputPanel id="outPa">
						<p:autoComplete value="#{AgendaController.agenda.paciente}" 
							size="60" converter="conPaciente" 
							completeMethod="#{PacienteController.listaPacienteAutoComplete}"
							effect="fade" var="theme" forceSelection="true"
							minQueryLength="1" itemValue="#{theme}"  itemLabel="#{theme.nome}">
							<p:ajax event="itemSelect" update=":formAgendaMedica:outProg" global="false"/>
							<p:ajax event="change" update=":formAgendaMedica"
								listener="#{AgendaController.limparNaBuscaPaciente()}" global="false"/>

						</p:autoComplete>
					</p:outputPanel>
				</div>
				<div class="col-sm-1">
					<p:commandButton id="btBPa"
						styleClass="btn btn-primary text-center"
						action="#{AgendaController.limparNaBuscaPaciente()}"
						icon="ui-icon-search" style="margin-left:-20px;height:25px"
						update=":formAgendaMedica" onclick="PF('dlgConsuPac').show();" />
				</div>




				<h:outputLabel for="prog" value="Programa: *" />
				<p:outputPanel id="outProg">
					<p:autoComplete value="#{AgendaController.agenda.programa}"
						size="60" converter="conPrograma"
						disabled="#{AgendaController.agenda.paciente==null}"
						completeMethod="#{ProgramaController.listaProgramaAutoComplete}"
						effect="fade" var="theme" forceSelection="true" minQueryLength="1"
						itemValue="#{theme}" itemLabel="#{theme.descPrograma}">
						<p:ajax event="itemSelect"
							listener="#{GrupoController.selectPrograma}"
							update=":formAgendaMedica:outGrupo, :formConsuGrop:dtGrupo" />
						<p:ajax event="change" update=":formAgendaMedica"
							listener="#{AgendaController.limparNaBuscaPrograma()}" />
					</p:autoComplete>
				</p:outputPanel>
				<p:commandButton id="btBusPr" styleClass="btn btn-primary text-center" style="margin-left:-20px;height:25px" icon="ui-icon-search" 
					action="#{AgendaController.limparNaBuscaPrograma()}" 
					update=":formAgendaMedica" onclick="PF('dlgConsuProg').show();" />

				<h:outputLabel for="grupo" value="Grupo: *" />
				<p:outputPanel id="outGrupo">
					<p:autoComplete value="#{AgendaController.agenda.grupo}" size="60"
						converter="conGrupo"
						disabled="#{AgendaController.agenda.programa==null}"
						completeMethod="#{GrupoController.listaGrupoAutoComplete}"
						effect="fade" var="theme" forceSelection="true" minQueryLength="1"
						itemValue="#{theme}" itemLabel="#{theme.descGrupo}">
						<p:ajax event="itemSelect"
							listener="#{TipoAtendimentoController.selectGrupo}"
							update=":formAgendaMedica:outTipoAt, :formConsuTipoAt:dtTipoAt" />
						<p:ajax event="itemSelect"
							listener="#{ProfissionalController.atualizaListaProfPorGrupo}"
							update=":formAgendaMedica:outProf, :formConsuProf:dtProf" />
						<p:ajax event="change" update=":formAgendaMedica"
							listener="#{AgendaController.limparNaBuscaGrupo()}" />
					</p:autoComplete>
				</p:outputPanel>
				<p:commandButton id="btBusGr" styleClass="btn btn-primary text-center" style="margin-left:-20px;height:25px" icon="ui-icon-search"
					action="#{AgendaController.limparNaBuscaGrupo()}"
					update=":formAgendaMedica" onclick="PF('dlgConsuGrop').show();" />

				<h:outputLabel for="tipoAt" value="Tipo At.: *" />
				<p:outputPanel id="outTipoAt">
					<p:autoComplete value="#{AgendaController.agenda.tipoAt}" size="60"
						converter="conTipoAtendimento"
						disabled="#{AgendaController.agenda.grupo==null}"
						completeMethod="#{TipoAtendimentoController.listaTipoAtAutoComplete}"
						effect="fade" var="theme" forceSelection="true" minQueryLength="1"
						itemValue="#{theme}" itemLabel="#{theme.descTipoAt}">
						<p:ajax event="itemSelect" update=":formAgendaMedica" />
						<p:ajax event="change" update=":formAgendaMedica"
							listener="#{AgendaController.limparNaBuscaTipo()}" />
					</p:autoComplete>
				</p:outputPanel>
				<p:commandButton id="btBusTi" styleClass="btn btn-primary text-center" style="margin-left:-20px;height:25px" icon="ui-icon-search"
					action="#{AgendaController.limparNaBuscaTipo()}"
					update=":formAgendaMedica" onclick="PF('dlgConsuTipoAt').show();" />

				<h:outputLabel value="Profissional: *"
					rendered="#{AgendaController.agenda.tipoAt.equipe==false}" />
				<p:outputPanel id="outProf"
					rendered="#{AgendaController.agenda.tipoAt.equipe==false}">
					<p:autoComplete value="#{AgendaController.agenda.profissional}"
						size="60" converter="conProfissional"
						completeMethod="#{ProfissionalController.listaProfissionalAutoComplete}"
						effect="fade" var="theme" forceSelection="true" minQueryLength="1"
						itemValue="#{theme}" itemLabel="#{theme.descricaoProf}">
						<p:ajax event="itemSelect" update=":formAgendaMedica" />
					</p:autoComplete>
				</p:outputPanel>
				<p:commandButton id="btBusProf" value="Buscar"
					disabled="#{AgendaController.agenda.tipoAt==null}"
					action="#{AgendaController.limparNaBuscaEquipeProf()}"
					update=":formAgendaMedica" onclick="PF('dlgConsuProf').show();"
					rendered="#{AgendaController.agenda.tipoAt.equipe==false}" />

				<h:outputLabel for="equipe" value="Equipe: *"
					rendered="#{AgendaController.agenda.tipoAt.equipe==true}" />
				<p:outputPanel id="outEquipe"
					rendered="#{AgendaController.agenda.tipoAt.equipe==true}">
					<p:autoComplete value="#{AgendaController.agenda.equipe}" size="60"
						converter="conEquipe"
						completeMethod="#{EquipeController.listaEquipeAutoComplete}"
						effect="fade" var="theme" forceSelection="true" minQueryLength="1"
						itemValue="#{theme}" itemLabel="#{theme.descEquipe}">
						<p:ajax event="itemSelect" update=":formAgendaMedica" />
					</p:autoComplete>
				</p:outputPanel>
				<p:commandButton id="btBusEqui" value="Buscar"
					disabled="#{AgendaController.agenda.tipoAt==null}"
					onclick="PF('dlgConsuEquipe').show();"
					action="#{AgendaController.limparNaBuscaEquipeProf()}"
					update=":formAgendaMedica"
					rendered="#{AgendaController.agenda.tipoAt.equipe==true}" />

				<h:outputLabel for="obs" value="Obs.:" />
				<p:inputTextarea id="obs"
					value="#{AgendaController.agenda.observacao}" style="width: 328px"
					autoResize="false" />
			</div>

			<p:panelGrid columns="7" styleClass="semBorda">
				<p:outputPanel>
					<h:outputLabel value="Data para Atendimento *" />
					<br />
					<p:calendar value="#{AgendaController.agenda.dataAtendimento}"
						id="dtagen" locale="pt" navigator="true" mask="true"
						showOn="button" pattern="dd/MM/yyyy" />
				</p:outputPanel>

				<p:outputPanel>
					<h:outputLabel for="turno" value="Turno" />
					<br />
					<p:selectOneMenu value="#{AgendaController.agenda.turno}">
						<f:selectItem itemLabel="Manhã" itemValue="M" />
						<f:selectItem itemLabel="Tarde" itemValue="T" />
						<p:ajax event="change" process="@this dtagen"
							update=":formAgendaMedica:msgFeriado"
							listener="#{AgendaController.verificaDisponibilidadeData()}" />
					</p:selectOneMenu>
				</p:outputPanel>

				<p:commandButton value="Ver agenda" style="margin-top: 25px;"
					action="#{AgendaController.verAgenda()}"
					update=":formAgendaMedica:outMax, :formAgendaMedica:outQtd,
						 :formAgendaMedica:outlAgendados, :formAgendaMedica:dtAgData,
						 :formAgendaMedica:msgFeriado" />

				<p:outputPanel id="outQtd">
					<h:outputLabel for="qtd" value="Qtd." />
					<br />
					<p:inputText id="qtd" value="#{AgendaController.agenda.qtd}"
						style="width: 40px" readonly="true" />
				</p:outputPanel>

				<p:outputPanel id="outMax">
					<h:outputLabel for="max" value="Máx." />
					<br />
					<p:inputText id="max" value="#{AgendaController.agenda.max}"
						style="width: 40px" readonly="true" />
				</p:outputPanel>

				<p:commandButton value="Confirmar" style="margin-top: 25px;"
					update=":formAgendaMedica:dtNovosAg"
					action="#{AgendaController.addListaNovosAgendamentos()}" />

				<p:commandButton value="Limpar Busca" style="margin-top: 25px;"
					actionListener="#{AgendaController.limparDados()}"
					update=":formAgendaMedica" />
			</p:panelGrid>

			<p:panelGrid columns="1" styleClass="semBorda">
				<h:outputLabel value="Novo(s) Agendamento(s)" />
				<p:dataTable id="dtNovosAg" resizableColumns="true"
					value="#{AgendaController.listaNovosAgendamentos}" var="agend"
					emptyMessage="Sem registros.">
					<p:column headerText="Data">
						<h:outputLabel value="#{agend.dataAtendimento}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputLabel>
					</p:column>

					<p:column headerText="Turno">
						<h:outputLabel value="MANHÃ" rendered="#{agend.turno == 'M'}" />
						<h:outputLabel value="TARDE" rendered="#{agend.turno == 'T'}" />
					</p:column>

					<p:column headerText="Cód. Tipo Atend.">
						<h:outputLabel value="#{agend.tipoAt.idTipo}" />
					</p:column>

					<p:column headerText="Tipo de Atendimento">
						<h:outputLabel value="#{agend.tipoAt.descTipoAt}" />
					</p:column>

					<p:column headerText="Obs.">

						<h:outputLabel value="#{agend.observacao}" />
					</p:column>
				</p:dataTable>

				<p:panelGrid columns="2">
					<h:outputLabel value="Agendados na Data" />
					<h:outputLabel id="outlAgendados"
						value="#{AgendaController.agenda.dataAtendimento}">
						<f:convertDateTime pattern="dd/MM/yyyy" />
					</h:outputLabel>
				</p:panelGrid>
				<p:dataTable id="dtAgData" var="agendaD"
					value="#{AgendaController.listaAgendamentosData}"
					resizableColumns="true" emptyMessage="Sem registros.">
					<p:column headerText="Cod.">
						<h:outputLabel value="#{agendaD.idAgenda}" />
					</p:column>

					<p:column headerText="Data">
						<h:outputLabel value="#{agendaD.dataAtendimento}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputLabel>
					</p:column>

					<p:column headerText="Pront.">
						<h:outputLabel value="#{agendaD.paciente.id_paciente}" />
					</p:column>

					<p:column headerText="Paciente">
						<h:outputLabel value="#{agendaD.paciente.nome}" />
					</p:column>

					<p:column headerText="Tipo">
						<h:outputLabel value="#{agendaD.tipoAt.descTipoAt}" />
					</p:column>
				</p:dataTable>
			</p:panelGrid>

			<center>
				<p:panelGrid columns="4" styleClass="semBorda">

					<p:commandButton value="Gravar" icon="confirmar"
						action="#{AgendaController.gravarAgenda()}"
						update=":formAgendaMedica" />

					<p:commandButton value="Consultar" icon="buscar"
						action="/pages/agenda/consAgendamentos.xhtml?faces-redirect=true" />

					<p:commandButton value="Limpar" icon="limpar"
						actionListener="#{AgendaController.limparDados()}"
						update=":formAgendaMedica" />

					<p:commandButton value="Voltar" icon="btvoltar" style="width:80px;"
						update=":formAgendaMedica"
						actionListener="#{AgendaController.limparDados()}"
						action="/pages/comum/selecaoSistema.xhtml?faces-redirect=true" />
				</p:panelGrid>
			</center>

		</h:form>


		<p:dialog header="Consulta Pacientes" widgetVar="dlgConsuPac"
			modal="true" width="750px">
			<h:form id="formConsuPac">
				<p:growl id="msgC" />
				<center>
					<p:panelGrid columns="2" styleClass="semBorda">
						<p:outputPanel id="outOp">
							<h:outputLabel for="op" value="Opção" />
							<br />
							<p:selectOneMenu id="op" value="#{PacienteController.tipoBuscar}">
								<f:selectItem itemLabel="Escolha Opção" itemValue="VAZIO" />
								<f:selectItem itemLabel="CPF" itemValue="CPF" />
								<f:selectItem itemLabel="Nome" itemValue="NOME" />
								<f:selectItem itemLabel="Prontuário Velho"
									itemValue="PRONTVELHO" />
								<f:selectItem itemLabel="Prontuário Novo" itemValue="PRONTNOVO" />
							</p:selectOneMenu>
						</p:outputPanel>

						<p:outputPanel id="outDesP">
							<h:outputLabel for="descPac" value="Descrição" />
							<br />
							<p:inputText id="descPac"
								value="#{PacienteController.descricaoParaBuscar}"
								style="width: 300px" />
						</p:outputPanel>
					</p:panelGrid>

					<p:separator style="margin-top: 10px;" />

					<p:panelGrid columns="3" styleClass="semBorda">
						<p:commandButton value="OK" icon="ui-icon-check"
							action="#{PacienteController.buscarPaciente()}"
							update=":formConsuPac:msgC" />
						<p:commandButton value="Nova Consulta" icon="ui-icon-search"
							actionListener="#{PacienteController.limparDados()}"
							update=":formConsuPac:outOp, :formConsuPac:outDesP" />
						<p:commandButton
							actionListener="#{PacienteController.limparDados()}"
							onclick="PF('dlgConsuPac').hide();"
							update=":formConsuPac:outOp, :formConsuPac:outDesP"
							value="Sair" icon="ui-icon-close" />
					</p:panelGrid>
				</center>

				<b:dataTable id="dt" var="tab"
					value="#{PacienteController.listaPacientesParaAgenda}" lang="es"
					display="Nenhum Paciente">

					<h:column>
						<f:facet name="header">
                        Prontuário
                    </f:facet>

						<p:outputLabel value="#{pacie.id_paciente}" />
					</h:column>

					<h:column>
						<f:facet name="header">
                        Nome
                    </f:facet>

						<p:outputLabel value="#{pacie.nome}" />
					</h:column>

					<h:column>
						<f:facet name="header">
                        Cpf
                    </f:facet>
						<p:outputLabel value="#{pacie.cpf}" />
					</h:column>

					<h:column>
						<f:facet name="header">
                        Cpf
                    </f:facet>
						<h:commandButton
							update=":formAgendaMedica:outPa, :formAgendaMedica:btBusPr, :formAgendaMedica:outProg"
							icon="ui-icon-check" title="Selecionar"
							onclick="PF('dlgConsuPac').hide();">
							<f:setPropertyActionListener value="#{pacie}"
								target="#{AgendaController.agenda.paciente}" />
						</h:commandButton>

					</h:column>


</b:dataTable>
			</h:form>
		</p:dialog>

		<p:dialog header="Consulta Programas" widgetVar="dlgConsuProg"
			modal="true" width="500px">
			<h:form id="formConsuProg">
				<p:dataTable value="#{ProgramaController.listaProgramas}" var="prog"
					resizableColumns="true"
					emptyMessage="Não existe nenhum programa cadastrado!">
					<p:column headerText="CÓD.">
						<p:outputLabel value="#{prog.idPrograma}" />
					</p:column>
					<p:column headerText="PROGRAMA">
						<p:outputLabel value="#{prog.descPrograma}" />
					</p:column>
					<p:column style="width:50px;text-align: center">
						<p:commandButton
							update=":formAgendaMedica:outProg, :formConsuGrop:dtGrupo, 
							:formAgendaMedica:btBusGr, :formAgendaMedica:outGrupo"
							icon="ui-icon-check" title="Selecionar"
							action="#{GrupoController.atualizaLista(AgendaController.agenda.programa)}"
							onclick="PF('dlgConsuProg').hide();">
							<f:setPropertyActionListener value="#{prog}"
								target="#{AgendaController.agenda.programa}" />
						</p:commandButton>
					</p:column>
				</p:dataTable>
			</h:form>
		</p:dialog>

		<p:dialog header="Consulta Grupos" widgetVar="dlgConsuGrop"
			modal="true" width="550px">
			<h:form id="formConsuGrop">
				<p:dataTable value="#{GrupoController.listaGruposProgramas}"
					id="dtGrupo" resizableColumns="true" var="grupo"
					emptyMessage="Não existe nenhum grupo cadastrado!">
					<p:column headerText="CÓD.">
						<p:outputLabel value="#{grupo.idGrupo}" />
					</p:column>
					<p:column headerText="GRUPO">
						<p:outputLabel value="#{grupo.descGrupo}" />
					</p:column>
					<p:column headerText="QTD. FREQ>">
						<p:outputLabel value="#{grupo.qtdFrequencia}" />
					</p:column>

					<p:column style="width:50px;text-align: center">
						<p:commandButton
							update=":formAgendaMedica:outGrupo, :formConsuTipoAt:dtTipoAt,
							 :formAgendaMedica:btBusTi, :formAgendaMedica:outTipoAt"
							icon="ui-icon-check" title="Selecionar"
							onclick="PF('dlgConsuGrop').hide();"
							action="#{TipoAtendimentoController.atualizaListaTipos(AgendaController.agenda.grupo)}">
							<f:setPropertyActionListener value="#{grupo}"
								target="#{AgendaController.agenda.grupo}" />
						</p:commandButton>
					</p:column>
				</p:dataTable>
			</h:form>
		</p:dialog>

		<p:dialog header="Consulta Tipos de Atendimento"
			widgetVar="dlgConsuTipoAt" modal="true" width="550px">
			<h:form id="formConsuTipoAt">
				<p:dataTable value="#{TipoAtendimentoController.listaTipos}"
					id="dtTipoAt" resizableColumns="true" var="tipo"
					emptyMessage="Não existe nenhum tipo cadastrado!">
					<p:column headerText="CÓD.">
						<p:outputLabel value="#{tipo.idTipo}" />
					</p:column>
					<p:column headerText="Tipo de Atendimento">
						<p:outputLabel value="#{tipo.descTipoAt}" />
					</p:column>

					<p:column style="width:50px;text-align: center">
						<p:commandButton
							update=":formAgendaMedica:outTipoAt, :formAgendaMedica"
							icon="ui-icon-check" title="Selecionar"
							onclick="PF('dlgConsuTipoAt').hide();">
							<f:setPropertyActionListener value="#{tipo}"
								target="#{AgendaController.agenda.tipoAt}" />
						</p:commandButton>
					</p:column>
				</p:dataTable>
			</h:form>
		</p:dialog>

		<p:dialog header="Consulta Equipes" widgetVar="dlgConsuEquipe"
			modal="true" width="550px">
			<h:form id="formConsuEquipe">
				<p:dataTable value="#{EquipeController.listaEquipe}" id="dtEquipe"
					resizableColumns="true" var="equipe"
					emptyMessage="Não existe nenhuma equipe cadastrada!">
					<p:column headerText="CÓD.">
						<p:outputLabel value="#{equipe.codEquipe}" />
					</p:column>
					<p:column headerText="Descrição">
						<p:outputLabel value="#{equipe.descEquipe}" />
					</p:column>

					<p:column style="width:50px;text-align: center">
						<p:commandButton update=":formAgendaMedica:outEquipe"
							icon="ui-icon-check" title="Selecionar"
							onclick="PF('dlgConsuEquipe').hide();">
							<f:setPropertyActionListener value="#{equipe}"
								target="#{AgendaController.agenda.equipe}" />
						</p:commandButton>
					</p:column>
				</p:dataTable>
			</h:form>
		</p:dialog>

		<p:dialog header="Consulta Profissionais" widgetVar="dlgConsuProf"
			modal="true" width="550px">
			<h:form id="formConsuProf">
				<p:dataTable value="#{ProfissionalController.listaProfissional}"
					id="dtProf" resizableColumns="true" var="profi"
					emptyMessage="Não existe nenhum tipo cadastrado!">
					<p:column headerText="CÓD.">
						<p:outputLabel value="#{profi.idProfissional}" />
					</p:column>
					<p:column headerText="Profissional">
						<p:outputLabel value="#{profi.descricaoProf}" />
					</p:column>
					<p:column headerText="Especialidade">
						<p:outputLabel value="#{profi.especialidade.descEspecialidade}" />
					</p:column>

					<p:column style="width:50px;text-align: center">
						<p:commandButton update=":formAgendaMedica:outProf"
							icon="ui-icon-check" title="Selecionar"
							onclick="PF('dlgConsuProf').hide();">
							<f:setPropertyActionListener value="#{profi}"
								target="#{AgendaController.agenda.profissional}" />
						</p:commandButton>
					</p:column>
				</p:dataTable>
			</h:form>
		</p:dialog>
	</ui:define>
</ui:composition>
</html>