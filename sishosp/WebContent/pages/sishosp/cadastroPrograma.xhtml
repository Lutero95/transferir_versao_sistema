<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:b="http://bootsfaces.net/ui"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="../../template/template.xhtml">

    <ui:define name="content">

        <f:metadata>
            <f:viewAction action="#{ProgramaController.getEditProg()}"/>
            <f:viewAction action="#{ProgramaController.listarProcedimentosIhCbos()}"/>
        </f:metadata>

        <div class="panel panel-primary top-primary">
            <div class="panel-heading top-heading">
                <h:outputText value="#{ProgramaController.cabecalho}"
                              class="panel-title"></h:outputText>
            </div>
            
						<h:form class="form-horizontal" id="frmPrincipal">
            <p:tabView id="tab">
            	<p:tab title="Dados Gerais">
					<div class="panel-body table-body sub-table-body">


							<b:row>

								<b:column span="12" class="label-position">
									<b:label for="inputname" value="Descrição" severity="info" />

									<b:inputText value="#{ProgramaController.prog.descPrograma}"
										class="form-control" id="inputname" required="true" ajax="true" 
										requiredMessage="Descrição: Campo obrigatório!"
										validatorMessage="Descrição: deve conter entre 2 e 50 caracteres.">
										<f:validateLength minimum="2" maximum="50" />
									</b:inputText>
								</b:column>
							</b:row>

							<br></br>

							<br></br>

							<b:row>
								<b:column span="2" class="label-position">
									<p:outputLabel value="Grupo:"
										style="margin-left:-15px; margin-top: 8px;
    									margin-bottom: 15px;color:#2e84ce;"></p:outputLabel>

									<p:commandButton process="@this" size="sm"
										action="#{GrupoController.listaTodosGrupos()}"
										title="Incluir Grupo" icon="ui-icon-plus"
										class="btn-acao-table acao-editar" style="margin-left: 20px;"
										oncomplete="PF('dlgConsuGrupos').show();"
										update=":formConsuGrop" />
								</b:column>

								<b:column span="9" class="label-position">

									<p:dataTable emptyMessage="Nenhum Grupo"
										styleClass="table table-hover" id="tabela"
										value="#{ProgramaController.prog.grupo}" var="tab"
										paginator="true" paginatorPosition="bottom" rows="12"
										resizableColumns="true" style="width:100%" scrollable="false">

										<p:column width="20%" headerText="Cód."
											style="font-weight:bold;">
											<h:outputText value="#{tab.idGrupo}" />
										</p:column>

										<p:column headerText="Nome" style="font-weight:bold;">
											<h:outputText value="#{tab.descGrupo}" />
										</p:column>
										
										<p:column headerText="Frequê. para o Programa" style="font-weight:bold;">
											<h:outputText value="#{tab.qtdFrequencia}" />
										</p:column>

										<p:column width="10%" headerText="Ação">
											<div align="center">
												<p:commandButton process="@this"
													class="new-btn-acao-table acao-excluir"
													action="#{ProgramaController.prog.removeGrupoLista()}"
													icon="ui-icon-trash" update="frmPrincipal:tab:tabela">
													<f:setPropertyActionListener value="#{tab}"
														target="#{ProgramaController.prog.grupoRmv}" />
												</p:commandButton>
											</div>
										</p:column>

									</p:dataTable>

								</b:column>
							</b:row>

							<b:row>

								<b:column span="3"
									class="label-position new-data-size new-comple1">
									<b:label value="Procedimento Padrão:" severity="info" />

									<p:outputPanel id="outProc">
										<p:autoComplete
											value="#{ProgramaController.prog.procedimento}" size="31"
											converter="conProcedimento" id="descProcP1" required="true"
											class="select-agendaEquipe4"
											requiredMessage="Escolha o procedimento padrão!"
											completeMethod="#{ProcedimentoController.listaProcedimentoAutoComplete}"
											effect="fade" var="theme" forceSelection="true"
											minQueryLength="1" itemValue="#{theme}"
											itemLabel="#{theme.nomeProc}">
											<p:ajax event="itemSelect"></p:ajax>
										</p:autoComplete>

										<p:commandButton id="btBusProcP1" icon="ui-icon-search"
											onclick="PF('dlgConsulProc').show();" immediate="true"
											actionListener="#{ProcedimentoController.listarProcedimentos()}" />
									</p:outputPanel>
								</b:column>

							</b:row>
					</div>
				</p:tab>
            	<p:tab title="Procedimentos para Ocupações Específicas">
						<p:commandButton
							icon="ui-icon-plus" size="sm"
							title="Adicionar Registro"
							update=":msgPagina :formConsulProcOcup" 
							class="btn-acao-table acao-editar"
							process="@this"
							actionListener="#{ProgramaController.limparProcedimentoIhCboSelecionado()}"
							oncomplete="PF('dlgConsulProcOcup').show();" />
							
						<p:dataTable id="tabProcCbo" var="procEsp" value="#{ProgramaController.prog.listaProcedimentoCboEspecificoDTO}"
							emptyMessage="Nenhum registro foi adicionado">
							<p:column headerText="Procedimento">
								<h:outputText value="#{procEsp.procedimento.nomeProc}" />
							</p:column>
							
							<p:column headerText="Código Procedimento" width="250">
								<h:outputText value="#{procEsp.procedimento.codProc}" />
							</p:column>

							<p:column headerText="CBO">
								<h:outputText value="#{procEsp.cbo.descCbo}" />
							</p:column>
							
							<p:column headerText="Código CBO" width="100">
								<h:outputText value="#{procEsp.cbo.codigo}" />
							</p:column>
							
							<p:column headerText="Remover" width="80">
								<p:commandButton icon="fa fa-fw fa-times"
									actionListener="#{ProgramaController.removerProcedimentoCboEspecifico(procEsp)}"
                                	title="Remover" update="frmPrincipal"
                                	style="margin-left:28%;"
                                	class="new-btn-acao-table acao-excluir"/>
							</p:column>
						</p:dataTable>
				</p:tab>
            </p:tabView>
				<div align="center">
					<br />
					<p:commandButton
						actionListener="#{ProgramaController.gravarPrograma()}"
						icon="ui-icon-check" size="sm" look="success"
						update="tab msgPagina" value="Incluir" process="@all"
						class="btn-incluir" rendered="#{ProgramaController.tipo == 1}" />

					<p:commandButton
						actionListener="#{ProgramaController.alterarPrograma()}"
						icon="ui-icon-check" size="sm" update="tab msgPagina"
						process="@all" class="btn-incluir" value="Alterar" look="success"
						rendered="#{ProgramaController.tipo  == 2}" />

					<p:commandButton value="Voltar" icon="glyphicon-arrow-left"
						class="btn-voltar" size="sm" immediate="true" look="info"
						action="/pages/sishosp/gerenciarPrograma.faces?faces-redirect=true">
					</p:commandButton>
				</div>
			</h:form>
		</div>
		
		<p:dialog header="Consultar Procedimento e Ocupações" styleClass="topDialog"
                  widgetVar="dlgConsulProcOcup" modal="true" resizable="false" height="400" width="70%" 
                  draggable="true" responsive="true" dynamic="true" minHeight="200">
            <h:form id="formConsulProcOcup">
                <p:outputPanel id="outproc">
                		<p:dataTable var="proc" value="#{ProgramaController.listaProcedimentos}"
							emptyMessage="Nenhum procedimento encontrado" paginator="true" rows="5"
							paginatorPosition="bottom">
							<p:column filterBy="#{proc.nomeProc}"  footerText="contains" filterMatchMode="contains" headerText="Procedimento">
								<h:outputText value="#{proc.nomeProc}" />
							</p:column>

							<p:column headerText="Código" width="100">
								<h:outputText value="#{proc.codProc}" />
							</p:column>
							
							<p:column headerText="Selecionar" width="100">
							<p:commandButton actionListener="#{ProgramaController.selecionarProcedimento(proc)}"
                                	icon="fa fa-fw ${ProgramaController.procedimentoSelecionado.idProc == proc.idProc ? 'fa-check' : 'fa-square-o'}"
                                	title="Selecionar" update="formConsulProcOcup"
                                	style="margin-left:30%;"
                                	class="new-btn-acao-table ${ProgramaController.procedimentoSelecionado.idProc == proc.idProc ? 'acao-editar' : ''}"/>
							</p:column>
						</p:dataTable>
                </p:outputPanel>
                
                <br /><br />
                <p:outputPanel id="outcbo">
                		<p:dataTable var="cbo" value="#{ProgramaController.listaCbos}"
							emptyMessage="Nenhuma ocupação encontrada" paginator="true" rows="5"
							paginatorPosition="bottom">
							<p:column filterBy="#{cbo.descCbo}" footerText="contains" filterMatchMode="contains" headerText="CBO">
								<h:outputText value="#{cbo.descCbo}" />
							</p:column>

							<p:column headerText="Código" width="100">
								<h:outputText value="#{cbo.codigo}" />
							</p:column>
							
							<p:column headerText="Selecionar" width="100">
								<p:commandButton actionListener="#{ProgramaController.selecionarCbo(cbo)}"
                                	icon="fa fa-fw ${ProgramaController.cboSelecionado.codCbo == cbo.codCbo ? 'fa-check' : 'fa-square-o'}"
                                	title="Selecionar" update="formConsulProcOcup"
                                	style="margin-left:30%;"
                                	class="new-btn-acao-table ${ProgramaController.cboSelecionado.codCbo == cbo.codCbo ? 'acao-editar' : ''}"/>
							</p:column>
						</p:dataTable>
                </p:outputPanel>
                
                <br />
                <div align="center">
                	<p:commandButton value="Incluir" 
                	update=":frmPrincipal :msgPagina" immediate="true"
                	action="#{ProgramaController.adicionarProcedimentoCboEspecifico()}"
                	disabled="#{ProgramaController.cboSelecionado.codCbo == null or ProgramaController.procedimentoSelecionado.idProc == null }"/>
                </div>
            </h:form>
        </p:dialog>

		<p:dialog header="Consultar Grupos" widgetVar="dlgConsuGrupos"
                  modal="true" styleClass="topDialog" resizable="false" 
                  draggable="false" responsive="true">
            <h:form id="formConsuGrop">
                <p:outputPanel>
                <p:autoUpdate/>
                    <b:dataTable customLangUrl="#{resource['pt-br.json']}"
                                 value="#{GrupoController.listaGrupos}" id="dtGrupo"
                                 display="Nenhum Grupo" var="grupo">

                        <h:column>
                            <f:facet name="header">
                                Grupo
                            </f:facet>
                            <p:outputLabel value="#{grupo.descGrupo}"/>
                        </h:column>

                        <h:column>
                            <f:facet name="header">
                                Adicionar
                            </f:facet>
                            <p:commandButton
                                    update=":formFreq, :msgPagina"
                                    icon="fa fa-fw fa-check" title="Selecionar"
                                    class="new-btn-acao-table acao-editar"
                                    oncomplete="PF('dlgFreq').show();">
                                <f:setPropertyActionListener value="#{grupo}"
                                                             target="#{ProgramaController.grupo}"/>
                            </p:commandButton>
                        </h:column>

                    </b:dataTable>
                </p:outputPanel>
            </h:form>
        </p:dialog>
        
        
        <p:dialog header="Selecione Frequência"
        		  widgetVar="dlgFreq" draggable="true" responsive="true"
                  modal="true" styleClass="topDialog" resizable="false">
            <h:form id="formFreq">
            	<h:outputLabel value="Frequência do Grupo #{ProgramaController.grupo.descGrupo} para o Programa"/>
				
				<div align="center">
					<div>
						<p:spinner value="#{ProgramaController.grupo.qtdFrequencia}"/>
					</div>

					<div>
						<br /><br />
						<p:commandButton update=":frmPrincipal:tab:tabela, :msgPagina"
							value="Confirmar" title="Confirmar"
							action="#{ProgramaController.validaFrequencia()}">
							<f:setPropertyActionListener value="#{ProgramaController.grupo}"
								target="#{ProgramaController.prog.grupoParaAdd}" />
						</p:commandButton>
					</div>
				</div>
			</h:form>
        </p:dialog>
        

        <p:dialog header="Consultar Procedimento" styleClass="topDialog"
                  widgetVar="dlgConsulProc" modal="true" resizable="false" 
                  draggable="false" responsive="true">
            <h:form id="formConsulProc">
                <p:outputPanel >
                <p:autoUpdate/>
                    <b:dataTable customLangUrl="#{resource['pt-br.json']}"
                                 value="#{ProcedimentoController.listaProcedimentos}" var="proc">

                        <h:column>
                            <f:facet name="header">
                                Descrição
                            </f:facet>
                            <p:outputLabel value="#{proc.nomeProc}"/>
                        </h:column>

                        <h:column>
                            <f:facet name="header">
                                Adicionar
                            </f:facet>
                            <p:commandButton
                                    icon="fa fa-fw fa-check" title="Selecionar"
                                    class="new-btn-acao-table acao-editar" update=":frmPrincipal"
                                    onclick="PF('dlgConsulProc').hide();">
                                <f:setPropertyActionListener value="#{proc}"
                                                             target="#{ProgramaController.prog.procedimento}"/>
                            </p:commandButton>
                        </h:column>
                    </b:dataTable>
                </p:outputPanel>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>