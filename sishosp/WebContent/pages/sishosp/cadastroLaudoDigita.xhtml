<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

<ui:composition template="../../template/templategeral.xhtml">

	<ui:define name="body">
		<!-- INICIO DO FORMULARIO -->
		<div class="col-md-8">
			<h:form>
			<h:commandButton value="Voltar"
					style="position:absolute; left:74%; top:100%;"
					styleClass="btn btn-info"
					action="/pages/sishosp/gerenciarLaudoDigita.faces?faces-redirect=true"></h:commandButton>
			</h:form>

			<h:form id="formLaudo">
				<p:growl id="message" />
				<p:panel header="#{LaudoController.cabecalho2}"
					style="position: relative; height:auto; width:660px; background-color: #F5F5F5; margin-left:50%;border: 3px solid gray;">
					<h:panelGrid columns="3">

						<h:outputLabel value="Paciente:" />
						<p:outputPanel id="outPacie">
							<p:autoComplete value="#{LaudoController.laudo.paciente}"
							size="60" converter="conPaciente"
							completeMethod="#{PacienteController.listaPacienteAutoComplete}"
							effect="fade" var="theme" forceSelection="true"
							minQueryLength="1" itemValue="#{theme}" itemLabel="#{theme.nome}">
							<p:ajax event="itemSelect" update=":formLaudo:outProfissional, :formLaudo:outPacie3, :formLaudo:outPacie2, :formLaudo:btBusPro" />
						</p:autoComplete>
						</p:outputPanel>
						<p:commandButton id="btBusPa" value="Buscar" icon="buscar"
							onclick="PF('dlgConsuPac').show();" />

						<h:outputLabel value="Profissional:" />
						<p:outputPanel id="outProfissional">
							  <p:autoComplete value="#{LaudoController.laudo.profissional}" size="60"
							  converter="conFuncionario"
							completeMethod="#{MBFuncionarios.listaProfissionalAutoComplete}"
							effect="fade" var="theme" forceSelection="true"
							minQueryLength="1" itemValue="#{theme}"
							itemLabel="#{theme.nome}">
							<p:ajax event="itemSelect" update=":formLaudo:outProce, :formLaudo:btBusProce" />
						</p:autoComplete>
						</p:outputPanel>
						<p:commandButton id="btBusPro" value="Buscar" icon="buscar"
							onclick="PF('dlgConsuProf').show();" />

						<h:outputLabel value="Procedimento:" />
						<p:outputPanel id="outProce">
							<p:autoComplete value="#{LaudoController.laudo.procedimento}" size="60"
							converter="conProcedimento"
							completeMethod="#{ProcedimentoController.listaProcedimentoAutoComplete}"
							effect="fade" var="theme" forceSelection="true"
							minQueryLength="1" itemValue="#{theme}"
							itemLabel="#{theme.nomeProc}">
							<p:ajax event="itemSelect" update=":formLaudo:outProfissional, :formLaudo:btBusProce" />
						</p:autoComplete>
						</p:outputPanel>
						<p:commandButton id="btBusProce" value="Buscar" icon="buscar"
							onclick="PF('dlgConsuProce').show();" />
					</h:panelGrid>

					<h:panelGrid columns="4" styleClass="semBorda"
						style="margin-top:20px;">

						<p:outputPanel id="outPacie3">
							<h:outputLabel value="CNS" />
							<br />
							<p:inputText id="codCns"
								value="#{LaudoController.laudo.paciente.cns}" readonly="true" />
						</p:outputPanel>
						<p:outputPanel id="outPacie2" style="margin-left:16px;">
							<h:outputLabel value="CPF" />
							<br />
							<p:inputText id="codCpf"
								value="#{LaudoController.laudo.paciente.cpf}" readonly="true" />
						</p:outputPanel>

						<!-- <p:outputPanel style="margin-left:16px;">
							<h:outputLabel for="dataAte" value="Data para Solicitação" />
							<br />
							<p:calendar id="data" locale="pt" showOn="button"
							required="true" requiredMessage="E necessario informar a data de solicitação"
								value="#{LaudoController.laudo.dtasolicitacao}" navigator="true"
								mask="true" pattern="dd/MM/yyyy" />
						</p:outputPanel> -->



					</h:panelGrid>


					<h:panelGrid columns="3" styleClass="semBorda">

						<p:outputPanel style="margin-top:10px;">

							<p:outputLabel value="Prorrogar:" />

							<p:selectOneRadio id="prorrogar" style="border: double;"
								required="true" layout="pageDirection"
								requiredMessage="Prorrogar e necessario"
								value="#{LaudoController.laudo.prorrogar}">

								<f:selectItem itemLabel="30 dias" itemValue="30" />
								<f:selectItem itemLabel="90 dias" itemValue="90" />
								<p:ajax event="change"
									update="dtFim, :formLaudo:message, prorrogar"
									process="@this,dataAte"
									listener="#{LaudoController.calcularDias}" />

							</p:selectOneRadio>
						</p:outputPanel>

						<p:outputPanel style="margin-left:16px;">
							<h:outputLabel value="Data para Solicitação" />
							<br />
							<p:calendar id="dataAte" locale="pt"
							required="true"
							requiredMessage="E necessario informar a data de solitação"
								value="#{LaudoController.laudo.dtasolicitacao}" 
								mask="true" pattern="dd/MM/yyyy" />


						</p:outputPanel>

						<p:outputPanel style="margin-left:16px;">
							<h:outputLabel value="Mês/Ano fim" />
							<br />	

							<p:outputLabel id="dtFim" value="#{LaudoController.laudo.dtafim}">
								<f:convertDateTime locale="pt" timeZone="-3GTM"
									pattern="dd/MM/yyyy" />
							</p:outputLabel>
						</p:outputPanel>
					</h:panelGrid>

					<p:separator></p:separator>
					<center>
						<h:panelGrid columns="3" styleClass="semBorda">

							<p:commandButton value="Gravar" icon="confirmar"
								update=":formLaudo:message,:formLaudo" style="margin-left:15px;"
								action="#{LaudoController.gravarLaudoDigita()}"
								rendered="#{LaudoController.tipo == 'I'}" />

							<p:commandButton action="#{LaudoController.alterarLaudoDigita()}"
								icon="alterar-dados" style="margin-left:15px;"
								update=":formLaudo:message,:formLaudo" value="Alterar"
								rendered="#{LaudoController.tipo == 'A'}" />

							<p:commandButton value="Limpar" icon="limpar"
								style="margin-left:15px;"
								actionListener="#{LaudoController.limparDados()}"
								update=":formLaudo" />

						</h:panelGrid>
					</center>
				</p:panel>
			</h:form>


			<p:dialog header="Consulta Pacientes" widgetVar="dlgConsuPac"
				modal="true" width="750px">
				<h:form id="formConsuPac">
					<p:growl id="msgC" />
					<center>
						<p:panelGrid columns="2" styleClass="semBorda">
							<p:outputPanel id="outOp">
								<h:outputLabel for="op" value="Opção" />
								<br />
								<p:selectOneMenu id="op"
									value="#{PacienteController.tipoBuscar}">
									<f:selectItem itemLabel="Escolha Opção" itemValue="VAZIO" />
									<f:selectItem itemLabel="CPF" itemValue="CPF" />
									<f:selectItem itemLabel="Nome" itemValue="NOME" />
									<f:selectItem itemLabel="Prontuário Velho"
										itemValue="PRONTVELHO" />
									<f:selectItem itemLabel="Prontuário Novo" itemValue="PRONTNOVO" />
								</p:selectOneMenu>
							</p:outputPanel>

							<p:outputPanel id="outDesP">
								<h:outputLabel value="Descrição" />
								<br />
								<p:inputText id="descPac"
									value="#{PacienteController.descricaoParaBuscar}"
									style="width: 300px" />
							</p:outputPanel>
						</p:panelGrid>

						<p:separator style="margin-top: 10px;" />

						<p:panelGrid columns="3" styleClass="semBorda">
							<p:commandButton value="OK" icon="ui-icon-check"
								action="#{PacienteController.buscarPaciente()}"
								update=":formConsuPac:msgC, :formConsuPac:dtPaci" />
							<p:commandButton value="Nova Consulta" icon="ui-icon-search"
								actionListener="#{PacienteController.limparDados()}"
								update=":formConsuPac:outOp, :formConsuPac:outDesP, :formConsuPac:dtPaci, :formLaudo:btBusPro" />
							<p:commandButton value="Sair" icon="ui-icon-close" />
						</p:panelGrid>
					</center>
					<p:dataTable resizableColumns="true" id="dtPaci"
						value="#{PacienteController.listaPacientesParaAgenda}" var="pacie"
						emptyMessage="Faça uma busca de paciente!">
						<p:column headerText="PRONTUÁRIO">
							<p:outputLabel value="#{pacie.id_paciente}" />
						</p:column>

						<p:column headerText="PRONT ANT.">
							<p:outputLabel value="#{pacie.protant}" />
						</p:column>

						<p:column headerText="NOME">
							<p:outputLabel value="#{pacie.nome}" />
						</p:column>

						<p:column headerText="CPF">
							<p:outputLabel value="#{pacie.cpf}" />
						</p:column>
						<p:column headerText="Confirmar"
							style="width:20%;text-align: center">
							<p:commandButton
								update=":formLaudo:outPacie, :formLaudo:outPacie2, :formLaudo:outPacie3,:formLaudo:outProfissional , :formLaudo:btBusPro"
								icon="confirmar" title="Selecionar"
								onclick="PF('dlgConsuPac').hide();">
								<f:setPropertyActionListener value="#{pacie}"
									target="#{LaudoController.laudo.paciente}" />
							</p:commandButton>
						</p:column>
					</p:dataTable>
				</h:form>
			</p:dialog>

			<p:dialog header="Consulta Profissional" widgetVar="dlgConsuProf"
				modal="true" width="550px">
				<h:form id="formConsuProf">
					<p:dataTable value="#{MBFuncionarios.listaProfissional}"
						id="dtProfissional" resizableColumns="true" var="profissional"
						emptyMessage="Não existe nenhum profissional cadastrado!">
						<p:column headerText="CÓD.">
							<p:outputLabel value="#{profissional.idProfissional}" />
						</p:column>
						<p:column headerText="Profissional">
							<p:outputLabel value="#{profissional.nome}" />
						</p:column>
						<p:column headerText="Especialidade">
							<p:outputLabel
								value="#{profissional.especialidade.descEspecialidade}" />
						</p:column>
						<p:column headerText="Max Atendimento">
							<p:outputLabel value="#{profissional.cns}" />
						</p:column>

						<p:column headerText="Confirmar"
							style="width:20%;text-align: center">
							<p:commandButton
								update=":formLaudo:outProfissional, :formConsuProf:dtProfissional, :formLaudo:btBusProce"
								icon="confirmar" title="Selecionar"
								onclick="PF('dlgConsuProf').hide();">
								<f:setPropertyActionListener value="#{profissional}"
									target="#{LaudoController.laudo.profissional}" />
							</p:commandButton>
						</p:column>
					</p:dataTable>
				</h:form>
			</p:dialog>

			<p:dialog header="Consulta Procedimento" widgetVar="dlgConsuProce"
				modal="true" width="550px">
				<h:form id="formConsuProce">
					<p:dataTable value="#{ProcedimentoController.listaProcedimentos}"
						id="dtProce" resizableColumns="true" var="procedimento"
						emptyMessage="Não existe nenhum procedimento cadastrado!">
						<p:column headerText="ID">
							<p:outputLabel value="#{procedimento.idProc}" />
						</p:column>
						<p:column headerText="CÓD.">
							<p:outputLabel value="#{procedimento.codProc}" />
						</p:column>
						<p:column headerText="PROCEDIMENTO">
							<p:outputLabel value="#{procedimento.nomeProc}" />
						</p:column>

						<p:column headerText="Confirmar"
							style="width:20%;text-align: center">
							<p:commandButton
								update=":formLaudo:outProce, :formConsuProce:dtProce"
								icon="confirmar" title="Selecionar"
								onclick="PF('dlgConsuProce').hide();">
								<f:setPropertyActionListener value="#{procedimento}"
									target="#{LaudoController.laudo.procedimento}" />
							</p:commandButton>
						</p:column>
					</p:dataTable>
				</h:form>
			</p:dialog>


		</div>

	</ui:define>
</ui:composition>
</html>