<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:stella="http://stella.caelum.com.br/faces2"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/template/templategeral.xhtml">


	<ui:define name="head">
		<link rel="StyleSheet" type="text/css" href="../../css/picklist.css" />
	</ui:define>

	<ui:define name="body">
		<h:form id="form"
			onkeypress="if (event.keyCode == 13) {
                                    document.getElementById('form:btnBusca').click();
                                    return false;
                                }">

			<p:growl id="message" />


			<p:panel header="Gerenciamento Usuários" id="panel">

				<p:panelGrid columns="1" styleClass="semBorda"
					style="float:left;font-size:12px;" id="panelBusca">

					<p:commandButton value="Novo Usuário" icon="ui-icon-plus"
						id="btNew" immediate="true" onclick="PF('dlgNovoUsuario').show();"
						actionListener="#{MBUsuarioCadastro.limparDados()}"
						action="#{MBUsuarioCadastro.limparDualCad()}"
						update=":formCADU:pnlCadUsuario" />

				</p:panelGrid>

				<p:dataTable id="tabela" var="user" rows="15" paginator="true"
					paginatorPosition="bottom" resizableColumns="false"
					emptyMessage="Nenhum dado encontrado."
					style="padding-bottom:5px;margin-top:45px;font-size:12px;height:600px;"
					value="#{MBUsuarioCadastro.listaUsuario}"
					filteredValue="#{MBUsuarioCadastro.listaUsuario}">

					<p:column headerText="Usuario">
						<h:outputText value="#{user.codigo} - #{user.nome}"></h:outputText>
					</p:column>

					<p:column headerText="Login">
						<h:outputText value="#{user.login}"></h:outputText>
					</p:column>

					<p:column headerText="Email">
						<h:outputText value="#{user.email}"></h:outputText>
					</p:column>

					<p:column headerText=" CPF">
						<h:outputText value="#{user.cpf}"></h:outputText>
					</p:column>

					<p:column headerText="Ação" style="width:2%;">
						<p:commandButton icon="alterar"
							title="Clique para Alterar o Usuário" immediate="true"
							actionListener="#{MBUsuarioCadastro.limparDados()}"
							action="#{MBUsuarioCadastro.limparDualAlt()}"
							oncomplete="altUsuario.show()" update=":formALTU:pnlAltUsuario">

							<f:setPropertyActionListener value="#{user}"
								target="#{MBUsuarioCadastro.usuarioEdit}" />
							<f:setPropertyActionListener value="#{user.codigo}"
								target="#{MBUsuarioCadastro.usuarioSelecionado}" />
							<f:setPropertyActionListener value="#{user.idPerfil}"
								target="#{MBUsuarioCadastro.perfilSelecionado}" />
						</p:commandButton>
					</p:column>

					<p:column headerText="Status" style="width:2%;">
						<p:column>
							<center>
								<p:graphicImage value="/imgs/confirma.png"
									rendered="#{user.ativo == 'S'}">
								</p:graphicImage>
							</center>
							<center>
								<p:graphicImage value="/imgs/delete32.png"
									rendered="#{user.ativo == 'N'}">
								</p:graphicImage>
							</center>
						</p:column>
					</p:column>
				</p:dataTable>

				<center>
					<div id="legenda">
						<h:outputText value="Legendas: " styleClass="rotulosBold" />
						<h:graphicImage value="/imgs/confirma.png"
							style="width:16px;height:18px;" />
						<h:outputText value=" Ativo   " styleClass="rotulos" />
						<h:graphicImage value="/imgs/delete32.png"
							style="width:18px;height:18px;" />
						<h:outputText value="  Inativos  " styleClass="rotulos" />
						<h:graphicImage value="/imgs/mnuManterProcesso.png"
							style="width:16px;height:16px;" />
						<h:outputText value="Alterar Usuário" styleClass="rotulos" />
					</div>
				</center>
			</p:panel>
		</h:form>

		<p:dialog header="Cadastrar Novo Usuário" widgetVar="dlgNovoUsuario"
			draggable="false" resizable="false" closable="true" modal="true"
			width="1000px" height="600px">
			<h:form id="formCADU">
				<p:panel id="pnlCadUsuario" style="height:590px">
					<p:tabView activeIndex="#{MBUsuarioCadastro.abaAtiva}"
						style="height:460px;" styleClass="semBorda">
						<p:tab title="Geral">

							<p:panelGrid styleClass="semBorda">
								<p:row>
									<p:column>
										<p:outputLabel value="Nome: ">
											<font color="#FF0000">*</font>
										</p:outputLabel>
									</p:column>
									<p:column>

										<p:inputText id="nome" size="45" required="false"
											requiredMessage="O campo nome é obrigatório."
											value="#{MBUsuarioCadastro.usuario.nome}" />

									</p:column>
								</p:row>

								<p:row>
									<p:column>
										<p:outputLabel value="CPF: ">
											<font color="#FF0000">*</font>
										</p:outputLabel>
									</p:column>
									<p:column>

										<p:inputText id="cpf" size="16" maxlength="11"
											value="#{MBUsuarioCadastro.usuario.cpf}"
											validatorMessage="O CPF informado esta incorreto."
											required="false" requiredMessage="O campo CPF é obrigatório.">
										</p:inputText>
									</p:column>
								</p:row>

								<p:row>
									<p:column>
										<p:outputLabel value="Email: ">
											<font color="#FF0000">*</font>
										</p:outputLabel>
									</p:column>

									<p:column>
										<p:inputText id="email" size="40"
											validatorMessage="Informe um email válido."
											value="#{MBUsuarioCadastro.usuario.email}">

											<f:validateRegex
												pattern="[a-zA-Z0-9\-\_\.]+@[a-zA-Z0-9\-\_\.]+" />
										</p:inputText>
									</p:column>
								</p:row>
							</p:panelGrid>

							<p:panelGrid styleClass="semBorda">
								<p:row>
									<p:column>
										<p:outputLabel value="Login: ">
											<font color="#FF0000">*</font>
										</p:outputLabel>
									</p:column>

									<p:column>
										<p:inputText id="login"
											value="#{MBUsuarioCadastro.usuario.login}"
											validator="#{MBUsuarioCadastro.verificaLoginCadastrado}"
											validatorMessage="Login já existe." required="true"
											requiredMessage="O campo login é obrigatório." />
									</p:column>
								</p:row>

								<p:row>
									<p:column>
										<p:outputLabel value="Senha: ">
											<font color="#FF0000">*</font>
										</p:outputLabel>
									</p:column>

									<p:column>
										<p:password id="pass1" required="false"
											requiredMessage="O campo senha é obrigatório."
											validatorMessage="Informe uma senha com no mínimo 6 caracteres e um máximo de 200."
											binding="#{MBUsuarioCadastro.senhaInput}"
											value="#{MBUsuarioCadastro.usuario.senha}" maxlength="200">

											<f:validateLength minimum="6" />
										</p:password>
									</p:column>

									<p:column>
										<p:outputLabel value="Confirmar senha: ">
											<font color="#FF0000">*</font>
										</p:outputLabel>
									</p:column>

									<p:column>
										<p:password id="pass2" required="false"
											validator="#{MBUsuarioCadastro.validateSenha}"
											validatorMessage="As senhas precisam ser iguais!"
											requiredMessage="O campo confirmar senha é obrigatório."
											maxlength="200">

											<f:validateLength minimum="6" />
										</p:password>
									</p:column>
								</p:row>

								<p:row>
									<p:column>
										<p:outputLabel value="Perfil: ">
											<font color="#FF0000">*</font>
										</p:outputLabel>
									</p:column>

									<p:column>
										<p:selectOneMenu
											value="#{MBUsuarioCadastro.perfilSelecionado}"
											required="true" requiredMessage="Selecione um perfil."
											style="width:130px;">

											<f:selectItem itemLabel="Selecione" itemValue="" />
											<f:selectItems value="#{perfilMB.listaPerfil}" var="perf"
												itemLabel="#{perf.descricao}" itemValue="#{perf.id}" />

											<p:ajax listener="#{MBUsuarioCadastro.limparDualCad()}" />
										</p:selectOneMenu>
									</p:column>
								</p:row>
							</p:panelGrid>


						</p:tab>

						<p:tab title="Associar Sistemas">
							<center>
								<p:panelGrid columns="2" styleClass="semBorda">
									<p:pickList id="pick"
										value="#{MBUsuarioCadastro.listaSistemasDual}" var="sis"
										itemLabel="#{sis.descricao}" itemValue="#{sis}"
										showCheckbox="true" converter="conPickListSistema"
										required="true"
										requiredMessage="Informe pelo menos um sistema."
										showSourceFilter="true" showTargetFilter="true"
										filterMatchMode="contains">

										<f:facet name="sourceCaption">Sistemas não associados</f:facet>
										<f:facet name="targetCaption">Sistemas associados</f:facet>

										<p:ajax event="transfer"
											listener="#{MBUsuarioCadastro.onTransferSistema}" />
									</p:pickList>
								</p:panelGrid>
							</center>
						</p:tab>

						<p:tab title="Permissões">

							<p:outputPanel autoUpdate="true">
								<center>
									<p:outputLabel
										value="Selecione um perfil para exibir as permissões que não estão associadas."
										style="font-size:18px !important;"
										rendered="#{MBUsuarioCadastro.perfilSelecionado == null}" />
								</center>

								<p:tabView id="tabvPerms"
									rendered="#{MBUsuarioCadastro.perfilSelecionado != null}">
									<p:tab title="Associar Menus">
										<p:panelGrid styleClass="semBorda" columns="2">
											<p:pickList id="pickMenu"
												value="#{MBUsuarioCadastro.listaMenusDual}" var="menu"
												itemLabel="#{menuMB.verificarTipoRel(menu.descricao, menu.tipo)} - #{menu.descSistema} (#{menu.siglaSistema})"
												itemValue="#{menu}" showCheckbox="true"
												showSourceFilter="true" showTargetFilter="true"
												filterMatchMode="contains" converter="conPickListMenu">

												<f:facet name="sourceCaption">Menus não associadas</f:facet>
												<f:facet name="targetCaption">Menus associadas</f:facet>

												<p:ajax event="transfer"
													listener="#{MBUsuarioCadastro.onTransferMenu}" />
											</p:pickList>
										</p:panelGrid>

									</p:tab>

									<!-- <p:tab title="Associar Funções">
										<p:panelGrid styleClass="semBorda" columns="2">
											<p:pickList id="pickFuncao"
												value="#{MBUsuarioCadastro.listaFuncoesDual}" var="funcao"
												itemLabel="#{funcao.descricao} - #{funcao.descSistema} (#{funcao.siglaSistema})"
												itemValue="#{funcao}" showCheckbox="true"
												showSourceFilter="true" showTargetFilter="true"
												filterMatchMode="contains" converter="conPickListFuncao">

												<f:facet name="sourceCaption">Funções não associadas</f:facet>
												<f:facet name="targetCaption">Funções associadas</f:facet>

												<p:ajax event="transfer"
													listener="#{MBUsuarioCadastro.onTransferFuncao}" />
											</p:pickList>
										</p:panelGrid>
									</p:tab>
									 -->
									 
									 <!-- <p:tab title="Associar Programa Grupo">
										<p:panelGrid styleClass="semBorda" columns="2">
											<p:pickList id="pickProgramaGrupo"
												value="#{MBUsuarioCadastro.listaProgGrupoDual}" var="funcao"
												itemLabel="#{funcao.descPrograma} - #{funcao.descGrupo})"
												itemValue="#{funcao}" showCheckbox="true"
												showSourceFilter="true" showTargetFilter="true"
												filterMatchMode="contains" converter="conPickListProgramaGrupo">

												<f:facet name="sourceCaption">Programa/Grupo não associadas</f:facet>
												<f:facet name="targetCaption">Programa/Grupo  associadas</f:facet>

												<p:ajax event="transfer"
													listener="#{MBUsuarioCadastro.onTransferProgramaGrupo}" />
											</p:pickList>
										</p:panelGrid>
									</p:tab>
									 -->
								</p:tabView>
							</p:outputPanel>
						</p:tab>
					</p:tabView>


					<center>
						<p:separator />
						<p:panelGrid columns="2" styleClass="semBorda">
							<p:outputLabel>
								<font color="#FF0000">(*)</font>
							</p:outputLabel>
							<p:outputLabel value="Preenchimento Obrigatório" />
						</p:panelGrid>

						<p:panelGrid columns="2" styleClass="semBorda">
							<p:commandButton value="Gravar" icon="confirmar"
								style="width:100px;"
								update=":form:tabela, :form:message, :formCADU:pnlCadUsuario"
								action="#{MBUsuarioCadastro.gravarUsuario()}"
								process="@this,:formCADU" />

							<p:commandButton value="Cancelar" icon="fechar"
								style="width:100px;" onclick="PF('dlgNovoUsuario').hide();"
								process="@this" />
						</p:panelGrid>
					</center>
				</p:panel>
			</h:form>
		</p:dialog>

		<p:dialog header="Alterar Dados Usuário" widgetVar="altUsuario"
			draggable="false" resizable="false" modal="true" width="1000"
			height="600px">

			<h:form id="formALTU">

				<p:panel id="pnlAltUsuario" style="height:590px">

					<p:tabView activeIndex="#{MBUsuarioCadastro.abaAtiva}"
						style="height:460px;">
						<p:tab title="Geral">
							<p:panelGrid styleClass="semBorda">
								<p:row>
									<p:column>
										<p:outputLabel value="Nome: ">
											<font color="#FF0000">*</font>
										</p:outputLabel>
									</p:column>

									<p:column>
										<p:inputText id="nome"
											value="#{MBUsuarioCadastro.usuarioEdit.nome}" size="45"
											required="true" requiredMessage="Informe o nome." />
									</p:column>
								</p:row>

								<p:row>
									<p:column>
										<p:outputLabel value="CPF: ">
											<font color="#FF0000">*</font>
										</p:outputLabel>
									</p:column>

									<p:column>
										<p:inputMask id="cpf" mask="999.999.999-99" size="16"
											required="true" requiredMessage="Informe o CPF."
											value="#{MBUsuarioCadastro.usuarioEdit.cpf}"
											validatorMessage="CPF inválido.">

											<stella:validateCPF formatted="true" />
										</p:inputMask>
									</p:column>
								</p:row>

								<p:row>
									<p:column>
										<p:outputLabel value="Email: ">
											<font color="#FF0000">*</font>
										</p:outputLabel>
									</p:column>

									<p:column>
										<p:inputText id="email" size="40" required="true"
											requiredMessage="Informe o Email."
											validatorMessage="Informe um email válido."
											value="#{MBUsuarioCadastro.usuarioEdit.email}">

											<f:validateRegex
												pattern="[a-zA-Z0-9\-\_\.]+@[a-zA-Z0-9\-\_\.]+" />
										</p:inputText>
									</p:column>
								</p:row>
							</p:panelGrid>

							<p:panelGrid styleClass="semBorda">
								<p:row>
									<p:column>
										<p:outputLabel value="Login: " />
									</p:column>

									<p:column>
										<font color="#0000FF"> <p:outputLabel id="usuario"
												value="#{MBUsuarioCadastro.usuarioEdit.login}" />
										</font>
									</p:column>

									<p:column>
										<p:commandButton value="Alterar senha" icon="alterar-senha"
											onclick="PF('altSenha').show();" immediate="true"
											update=":formALTS:pnlAltSenha" />
									</p:column>
								</p:row>
							</p:panelGrid>

							<p:panelGrid styleClass="semBorda">
								<p:row>
									<p:column>
										<p:outputLabel value="Perfil: ">
											<font color="#FF0000">*</font>
										</p:outputLabel>
									</p:column>

									<p:column>
										<p:selectOneMenu
											value="#{MBUsuarioCadastro.perfilSelecionado}"
											required="true" requiredMessage="Selecione um perfil."
											style="width:130px;">

											<f:selectItem itemLabel="Selecione" itemValue="" />
											<f:selectItems value="#{perfilMB.listaPerfil}" var="perf"
												itemLabel="#{perf.descricao}" itemValue="#{perf.id}" />

											<p:ajax listener="#{MBUsuarioCadastro.limparDualPerm()}" />
										</p:selectOneMenu>
									</p:column>
								</p:row>
							</p:panelGrid>

							<p:panelGrid styleClass="semBorda">
								<p:row>
									<p:column>
										<p:outputLabel value="Ativo: ">
											<font color="#FF0000">*</font>
										</p:outputLabel>
									</p:column>

									<p:column>
										<p:selectOneMenu
											value="#{MBUsuarioCadastro.usuarioEdit.ativo}">
											<f:selectItem itemLabel="Sim" itemValue="S" />
											<f:selectItem itemLabel="Não" itemValue="N" />
										</p:selectOneMenu>
									</p:column>
								</p:row>
							</p:panelGrid>
						</p:tab>

						<p:tab title="Associar Sistemas">
							<center>
								<p:panelGrid columns="2" styleClass="semBorda">
									<p:pickList id="pick"
										value="#{MBUsuarioCadastro.listaSistemasDualAlt}" var="sis"
										itemLabel="#{sis.descricao}" itemValue="#{sis}"
										showCheckbox="true" converter="conPickListSistema"
										required="true"
										requiredMessage="Informe pelo menos um sistema."
										showSourceFilter="true" showTargetFilter="true"
										filterMatchMode="contains">

										<f:facet name="sourceCaption">Sistemas não associados</f:facet>
										<f:facet name="targetCaption">Sistemas associados</f:facet>

										<p:ajax event="transfer"
											listener="#{MBUsuarioCadastro.onTransferSistema}" />
									</p:pickList>
								</p:panelGrid>
							</center>
						</p:tab>

					</p:tabView>

					<center>
						<p:separator />
						<p:panelGrid columns="2" styleClass="semBorda">
							<p:outputLabel>
								<font color="#FF0000">(*)</font>
							</p:outputLabel>
							<p:outputLabel value="Preenchimento Obrigatório" />
						</p:panelGrid>

						<p:panelGrid columns="2" styleClass="semBorda">
							<p:commandButton value="Gravar" icon="confirmar"
								style="width:100px;"
								action="#{MBUsuarioCadastro.alterarUsuario()}"
								update=":form:tabela, :form:message, :formALTU:pnlAltUsuario" />

							<p:commandButton value="Cancelar" icon="fechar"
								style="width:100px;" onclick="PF('altUsuario').hide();"
								process="@this" />
						</p:panelGrid>
					</center>
				</p:panel>
			</h:form>
		</p:dialog>

		<p:dialog header="Alterar Senha" widgetVar="altSenha"
			draggable="false" resizable="false" modal="true" width="auto">

			<h:form id="formALTS">

				<p:panel id="pnlAltSenha">

					<p:panelGrid columns="2" styleClass="semBorda">
						<p:outputLabel value="Senha: ">
							<font color="#FF0000">*</font>
						</p:outputLabel>

						<p:password id="senha" size="20" required="true"
							requiredMessage="Informe a senha."
							value="#{MBUsuarioCadastro.usuarioEdit.senha}" />
					</p:panelGrid>

					<center>
						<p:separator />
						<p:panelGrid columns="2" styleClass="semBorda">
							<p:outputLabel>
								<font color="#FF0000">(*)</font>
							</p:outputLabel>
							<p:outputLabel value="Preenchimento Obrigatório" />
						</p:panelGrid>

						<p:panelGrid columns="2" styleClass="semBorda">
							<p:commandButton value="Gravar" icon="confirmar"
								style="width:100px;"
								action="#{MBUsuarioCadastro.alterarSenha()}"
								update=":form:tabela, :form:message, :formALTU:pnlAltUsuario" />

							<p:commandButton value="Fechar" icon="fechar"
								style="width:100px;" onclick="PF('altSenha').hide();"
								process="@this" />
						</p:panelGrid>
					</center>
				</p:panel>
			</h:form>
		</p:dialog>

	</ui:define>
</ui:composition>
</html>