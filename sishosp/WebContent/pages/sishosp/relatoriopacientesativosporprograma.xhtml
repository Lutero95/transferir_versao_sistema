<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:b="http://bootsfaces.net/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="../../template/template.xhtml">
	<f:metadata>
		<f:viewAction
			action="#{RelatoriosController.preparaRelPacientesPorPrograma()}" />
	</f:metadata>
	<ui:define name="content">
		<br />
		<br />


		<div class="panel panel-primary top-primary">
			<div class="panel-heading top-heading">
				<h4 class="panel-title">Relatório: Pacientes Ativos por Programa</h4>
			</div>
			<p:growl id="grw" />
			<div class="panel-body table-body">
				<h:form id="frm">

					<b:row>
						<b:column span="3"
							class="label-position new-data-size new-comple1">
							<b:label value="Programa:" severity="info" />

							<p:outputPanel id="outProg">
								<p:autoComplete
									value="#{RelatoriosController.pacienteInstituicao.programa}"
									size="31" converter="conPrograma" class="select-agendaEquipe4"
									disabled="#{RelatoriosController.pacienteInstituicao.laudo.paciente==null}"
									completeMethod="#{ProgramaController.listaProgramaAutoCompleteUsuario}"
									effect="fade" var="theme" forceSelection="true"
									minQueryLength="1" itemValue="#{theme}"
									itemLabel="#{theme.descPrograma}">
									<p:ajax event="itemSelect"
										listener="#{AgendaController.selectPrograma}" update="outProg" />


								</p:autoComplete>

								<p:commandButton id="btBusPr" immediate="true"
									disabled="#{RelatoriosController.pacienteInstituicao.laudo.paciente==null}"
									icon="ui-icon-search"
									action="#{AgendaController.limparNaBuscaPrograma()}"
									actionListener="#{ProgramaController.carregaListaProgramasUsuario()}"
									update=":formConsuProg" oncomplete="PF('dlgConsuProg').show();" />
							</p:outputPanel>
						</b:column>

					</b:row>

					<b:row>
						<b:column>
							<p:selectOneRadio required="true"
								requiredMessage="Informe o Tipo da Geração" id="console"
								value="#{RelatoriosController.atributoGenerico1}"
								unselectable="true">
								<f:selectItem itemLabel="Intervalo de Idades" itemValue="I" />
								<f:selectItem itemLabel="Acima de" itemValue="A" />
								<p:ajax update="intervaloIdades" event="valueChange" />
							</p:selectOneRadio>
						</b:column>
					</b:row>

					<p:outputPanel id="intervaloIdades">

						<b:row>

							<b:column span="6"
								rendered="#{RelatoriosController.atributoGenerico1=='I'}"
								class="label-position new-comple1">
								<b:label value="Idade Mínima" severity="info" />
								<p:inputText size="1"
									value="#{RelatoriosController.idadeMinima}" />

								<b:label value=" Idade Máxima " severity="info" style="margin-left:20px"/>
								<p:inputText value="#{RelatoriosController.idadeMaxima}"
								 size="1"
									/>
							</b:column>

							<b:column span="3"
								rendered="#{RelatoriosController.atributoGenerico1=='A'}"
								class="label-position new-data-size new-comple1">


								<b:label value="Acima de" severity="info" />
								<p:inputText value="#{RelatoriosController.idadeMinima}"
									size="1" />

							</b:column>

						</b:row>

					</p:outputPanel>








					<br />

					<p:commandButton icon="ui-icon-print" value="Imprimir"
						target="_blank" style="font-size: 12px;  text-align: right;"
						update="grw"
						actionListener="#{RelatoriosController.gerarPacientesAtivosPorPrograma()}"
						ajax="false" />


				</h:form>
			</div>
		</div>

		<p:dialog header="Consultar Programas" widgetVar="dlgConsuProg"
			dynamic="true" modal="true" styleClass="topDialog">
			<h:form id="formConsuProg">
				<b:dataTable customLangUrl="#{resource['pt-br.json']}"
					value="#{ProgramaController.listaProgramasUsuario}" var="prog"
					display="Nenhum Programa">

					<h:column>
						<f:facet name="header">
                            Programa
                        </f:facet>
						<p:outputLabel value="#{prog.descPrograma}" />
					</h:column>

					<h:column>
						<f:facet name="header">
                            Adicionar
                        </f:facet>
						<p:commandButton update=":frm:outProg"
							class="new-btn-acao-table acao-editar" icon="fa fa-fw fa-check"
							title="Selecionar"
							action="#{AgendaController.atualizaListaGrupos(RelatoriosController.pacienteInstituicao.programa)}"
							actionListener="#{AgendaController.limparNaBuscaPrograma()}"
							oncomplete="PF('dlgConsuProg').hide();">
							<f:setPropertyActionListener value="#{prog}"
								target="#{RelatoriosController.pacienteInstituicao.programa}" />
						</p:commandButton>
					</h:column>

				</b:dataTable>
			</h:form>
		</p:dialog>

	</ui:define>

</ui:composition>
</html>
