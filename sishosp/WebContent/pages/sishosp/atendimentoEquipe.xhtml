<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:b="http://bootsfaces.net/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	template="../../template/template.xhtml">

	<ui:define name="content">
		<f:metadata>
			<f:viewAction
				action="#{AtendimentoController.getCarregaAtendimentoEquipe()}"  />
		</f:metadata>

		<div class="panel panel-primary top-primary">
			<div class="panel-heading top-heading">
				<h4 class="panel-title">Atendimento Equipe</h4>
			</div>

			<div class="panel-body table-body">

				<h:form>

					<b:row>
						<div align="center">
							<b:row>
								<p:commandButton value="Consultar Evolucao" look="success" size="sm"
												 icon="ui-icon-search" immediate="true" update=":frmPrincipal"
												 action="#{AtendimentoController.carregarEvolucoesPaciente(AtendimentoController.atendimento.paciente.id_paciente)}"
												 oncomplete="PF('dlgConsultaEvolucoes').show();"/>
							</b:row>
						</div>
					</b:row>

				</h:form>

				<h:form id="formConsAge">

					<p:outputPanel>
						<p:dataTable
							value="#{AtendimentoController.listAtendimentosEquipe}"
							id="dtAtendimentos" var="atendimento" editable="true"
							editMode="cell" emptyMessage="Sem registros.">

							<p:ajax event="cellEdit"
								listener="#{AtendimentoController.onCellEdit}" />

							<p:column headerText="CNS" width="10%">
								<h:outputText value="#{atendimento.funcionario.cns}"
									style="font-weight:bold;"></h:outputText>
							</p:column>

							<p:column headerText="Profissional" width="25%">
								<p:commandButton icon="ui-icon-search" class="btn-acao-table acao-editar"
								style="margin-right: 10px;"
								action="#{MBFuncionarios.listarProfissionaisConfigAgenda()}"
									oncomplete="PF('dlgConsultProfi').show()" update=":formConsultProf">
									<f:setPropertyActionListener value="#{atendimento}"
										target="#{AtendimentoController.atendimentoLista}" />
								</p:commandButton>
								<h:outputText value="#{atendimento.funcionario.nome}"
									style="font-weight:bold;"></h:outputText>
							</p:column>

							<p:column headerText="CBO" width="20%">
								<h:outputText value="#{atendimento.cbo.descCbo}"
									style="font-weight:bold;"></h:outputText>
							</p:column>

							<p:column headerText="Procedimento" width="20%">
								<p:commandButton icon="ui-icon-search" class="btn-acao-table acao-editar"
								action="#{AtendimentoController.listarProcedimentos()}"
									oncomplete="PF('dlgConsulProc1').show()" update=":formConsulProc1">
									<f:setPropertyActionListener value="#{atendimento}"
										target="#{AtendimentoController.atendimentoLista}" />
								</p:commandButton>
								<h:outputText value="#{atendimento.procedimento.nomeProc}"
									style="font-weight:bold;"></h:outputText>
							</p:column>

							<p:column headerText="Status" width="15%">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputLabel value="Atendido"
											rendered="#{atendimento.status == 'A'}" />
										<h:outputLabel value="Profissional Faltou"
											rendered="#{atendimento.status == 'PF'}" />
										<h:outputLabel value="Selecione"
											rendered="#{atendimento.status == ''}" />

									</f:facet>
									<f:facet name="input">
										<p:selectOneMenu value="#{atendimento.status}"
											style="width:150px;">
											<f:selectItem itemLabel="Selecione" itemValue="" />
											<f:selectItem itemLabel="Atendido" itemValue="A" />
											<f:selectItem itemLabel="Profissional Faltou" itemValue="PF" />
											<p:ajax
												listener="#{AtendimentoController.chamarMetodoTabelaAtendimentoEquipe()}"
												update=":formConsAge"></p:ajax>
										</p:selectOneMenu>
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column headerText="Evolução" width="10%">
								<div align="center">
									<p:commandButton icon="ui-icon-document" size="sm"
									class="btn-acao-table acao-editar"
										action="#{AtendimentoController.abrirDialogAtendimentoPorEquipe()}">
										<f:setPropertyActionListener value="#{atendimento.id1}"
											target="#{AtendimentoController.idAtendimento1}" />
									</p:commandButton>
								</div>
							</p:column>

						</p:dataTable>

					</p:outputPanel>

					<div align="center">
						<b:messages value="Error" id="msgPagina"></b:messages>
					</div>
					
					<br></br>

					<div align="center">

						<b:commandButton
							action="#{AtendimentoController.realizarAtendimentoEquipe()}"
							icon="glyphicon-ok" size="sm" look="success" value="Gravar"
							update="msgPagina" class="btn-incluir" style="float:left" />

						<b:commandButton value="Voltar" icon="glyphicon-arrow-left"
							size="sm" immediate="true" look="info" update=":formConsAge"
							style="float:right" class="btn-voltar"
							action="/pages/sishosp/atendimento.faces?faces-redirect=true">
						</b:commandButton>

					</div>

				</h:form>
			</div>
		</div>

		<p:dialog header="Consultar Profissionais" widgetVar="dlgConsultProfi"
			modal="true" width="750px"  styleClass="topDialog">
			<h:form id="formConsultProf">
				<b:dataTable customLangUrl="#{resource['pt-br.json']}"
					value="#{MBFuncionarios.listaProfissional}"
					id="dtTipoAt" var="profi">

					<h:column>
						<f:facet name="header">
                            Profissional
                        </f:facet>
						<p:outputLabel value="#{profi.nome}" />
					</h:column>

					<h:column>
						<f:facet name="header">
                            Especialidade
                        </f:facet>
						<p:outputLabel value="#{profi.especialidade.descEspecialidade}" />
					</h:column>

					<h:column>
						<f:facet name="header">
                            Adicionar
                        </f:facet>
						<p:commandButton update=":formConsAge" icon="ui-icon-check"
							action="#{AtendimentoController.chamarMetodoTabelaAtendimentoEquipe()}"
							title="Selecionar" class="new-btn-acao-table acao-editar">
							<f:setPropertyActionListener value="#{profi}"
								target="#{AtendimentoController.funcionario}" />
						</p:commandButton>
					</h:column>

				</b:dataTable>
			</h:form>
		</p:dialog>

		<p:dialog header="Consultar Procedimento" widgetVar="dlgConsulProc1"
			modal="true" width="750px" styleClass="topDialog">
			<h:form id="formConsulProc1">
				<b:dataTable customLangUrl="#{resource['pt-br.json']}"
					value="#{AtendimentoController.listaProcedimentos}" var="proc"
					display="Nenhum Procedimento">

					<h:column>
						<f:facet name="header">
                            Descrição
                        </f:facet>
						<p:outputLabel value="#{proc.nomeProc}" />
					</h:column>
  
					<h:column>
						<f:facet name="header">
                            Adicionar
                        </f:facet>
						<p:commandButton update=":formConsAge" icon="ui-icon-check"
							action="#{AtendimentoController.chamarMetodoTabelaAtendimentoEquipe()}"
							title="Selecionar" class="new-btn-acao-table acao-editar">
							<f:setPropertyActionListener value="#{proc}"
								target="#{AtendimentoController.procedimento}" />
						</p:commandButton>
					</h:column>


				</b:dataTable>
			</h:form>
		</p:dialog>

		<p:dialog header="Digite a evolução" widgetVar="dlgEvolucao"
			modal="true" width="750px" styleClass="topDialog">
			<h:form id="formEvolucao">
				<p:editor widgetVar="editor2"
					value="#{AtendimentoController.atendimento.evolucao}"
					required="true" requiredMessage="Evolução: Campo obrigatório!">

				</p:editor>

				<br></br>

				<div align="center">
					<p:commandButton
						action="#{AtendimentoController.adicionarEvolucaoAtendimentoEquipe()}"
						icon="ui-icon-disk" class="btn-acao-table acao-confirmar"
						value="Gravar Evolução" style="float:left" />
				</div>
			</h:form>
		</p:dialog>

        <p:dialog header="Consultar Evoluções" widgetVar="dlgConsultaEvolucoes"  width="850px" height="500px" styleClass="topDialog">

            <h:form id="frmPrincipal">

                <p:outputPanel id="outDtEvolucoes">

                    <b:row>
                        <b:column span="12">
                            <ui:repeat var="evo"
                                       value="#{AtendimentoController.listaEvolucoes}"
                                       varStatus="status">

                                <p:panelGrid columns="2" styleClass="semBorda2">

                                    <h:outputLabel value="Data Atendimento:"/>
                                    <h:outputLabel value="#{evo.dataAtendimentoInicio}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputLabel>

                                    <h:outputLabel value="Profissional:"/>
                                    <h:outputLabel value="#{evo.funcionario.nome}"/>

                                    <h:outputLabel value="Evolução:"/>
                                    <h:outputLabel value="#{evo.evolucao}"/>

                                    <hr></hr>
                                </p:panelGrid>

                            </ui:repeat>

                        </b:column>
                    </b:row>
                </p:outputPanel>


            </h:form>

        </p:dialog>

	</ui:define>

</ui:composition>